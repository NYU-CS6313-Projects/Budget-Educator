<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>NYU - CS6313 - Project 'NYU School Budget Distribution'</title>
	<script type="text/javascript" src="libraries/jquery-1.11.2.min.js"></script>
	<script type="text/javascript" src="libraries/d3.min.js"></script>
	<script type="text/javascript" src="libraries/bootstrap.min.js"></script>
  <script type="text/javascript" src="libraries/knockout-2.2.0.js"></script>
	<link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/table-style.css">
  <link rel="stylesheet" href="css/scatterplot-style.css">
  <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.14/themes/css/cartodb.css" />
  <link rel="stylesheet" href="css/map-style.css">
</head>

<body>
	<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">NYC School Budget Distribution</a>
      </div> <!-- .navbar-header -->
      <div id="navbar" class="navbar-collapse collapse">
      	<!-- <form class="navbar-form navbar-right">
          <input type="text" class="form-control" placeholder="Search...">
        </form> -->
        <ul class="nav navbar-nav">
          <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
              	<span id="school-category-label">School Category: </span> <span class="caret"></span>
              </a>
              <ul class="dropdown-menu scrollable-menu" id="school-category"></ul>
            </li>
          <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
              	<span id="y-axis-label">Y-Axis: </span> <span class="caret"></span>
              </a>
              <ul class="dropdown-menu scrollable-menu" id="y-axis"></ul>
            </li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a id="clear" href="#">Clear All</a></li>
        </ul>
      </div>
    </div>
  </nav>
	<div class="container-fluid">
		<div class="row">
			<div class="sidebar sidebar-left col-xs-12 col-sm-3 col-md-2">
				<table id="directory" class="table table-striped">
				</table>
			</div>
      <div class="col-sm-5 col-sm-offset-3 col-md-6 col-md-offset-2 main">        
        <div id="scatterplot"></div>
          <!-- <p><b>X-Axis:</b> <span id="x-a">Total Budget / Number of Students (in School)</span> </p>
          <p><b>Y-Axis:</b> <span id="y-a"></span> </p> -->
      </div>
      <div class="col-sm-4 col-md-4 main" id="map">
      </div>
		</div>
	</div>

	
	<script src="scripts/table.js"></script>
  <script src="scripts/scatterplot.js"></script>  
  <script src="http://libs.cartocdn.com/cartodb.js/v3/3.14/cartodb.js"></script>
  <script src="scripts/map.js"></script>
  <script type="text/javascript">

    var remove = function( id, removingClass ){
      $( id ).each(function( index ) {
          $( this ).removeClass( removingClass );
        });
    }

    // Imports the CSV, fills in the Y-Axis listing and school listing in table
    d3.csv("overview.csv", function( directory ) {
      var categories = [];

      // Initialize the interface and save the table for faster lookup
      var table = loadInterface( directory );

      // Store the directory into a var in scatterplot.js to prevent having to pass data around more than once
      cacheData( directory );

      // Load up and populate the scatterplot
      var initialY = $('#y-axis li.dropdownSelected a')[0].text;
      var plot = loadScatterPlot();
      populatePlot( plot, initialY, categories );

      // Configure the y-axis dropdown to update the scatterplot on click
      $('#y-axis li a').on('click', function(e){
        populatePlot( plot, $(this)[0].text, categories );
      });

      // Configure the school category dropdown to update the scatterplot 
      $('#school-category').on('click', function(e){
        var ylabel = $("#y-axis .dropdownSelected a")[0].text;

        // Update the scatterplot based on what school categories to focus on
        categories = [];
        $("#school-category .dropdownSelected a").each(function(index, category){
          categories.push(category.text);
        })

        // After populating the plot, update the table to only show schools of that category
        if ( populatePlot( plot, ylabel, categories ) ){
          var shownSchools = [];
          fetchFilteredData().forEach( function(d,i){
            shownSchools.push( d["DBN"] );
          });
          limitSchoolCategory(shownSchools);
        }

      });

      // Configure each school selection to update the scatterplot on click
      $('#directory').on('click', function(e){
        var selection = [];
        $(".schoolSelected").each( function(index, school){ 
          selection.push( school.id ); 
        });
        highlight(selection, table);
      });

      $( "#clear" ).on('click', function() {

        $("#y-axis-label").text( "Y-Axis: " );
        $("#school-category-label").text( "School Category: " );
        remove( "#y-axis li", 'dropdownSelected' );
        remove( "#school-category li", 'dropdownSelected' );
        remove( ".schoolSelected", 'schoolSelected' );

        // Default y-axis selection to the first item
        $( "#y-axis li:first-child" ).addClass( 'dropdownSelected' );
        categories = [];

        highlight( [], table);
        showAllTableEntries();
        sortBySelection( false );
        populatePlot( plot, 'Total Enrollment', categories );
      });
    });
  </script>
</body>
</html>